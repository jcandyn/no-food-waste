<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Zero Food Waste</title>
     <link rel="stylesheet" href="../public/css/inventory.css">
    {{!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"> --}}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
</head>

<body>
    <div class="container">
        <h1 class="px-4 mb-3">Inventory</h1>
        <main>
            {{!-- <button id="addButton" type="submit" >Add food items</button> --}}
            <button class="btn btn-primary addButton active" data-form="addButton">Add Food</button>
            <button class="btn btn-secondary closeButton" data-form="closeButton">Close </button>
            <div id="addFood" class="container" >
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Enter the food details </h5>
                <form id="addFood-form" method="post" action="/food">
                <div class="row">
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="itemName">Item Name:
                                <input type="text" name="itemName" id="itemName" placeholder="Eg:Milk"  >
                            </label><br>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="quantity">Quantity:
                                <input type="number" step="0.01" name="quantity" id="quantity" placeholder="Eg:2" >
                            </label><br>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="unit"> Unit:
                                <select name="unit" id="unit">
                                    <option value="">Select...</option>
                                    <option value="tsp">Teaspoon</option>
                                    <option value="tbsp">Tablespoon</option>
                                    <option value="c">Cup</option>
                                    <option value="pt">Pint</option>
                                    <option value="qt">Quart</option>
                                    <option value="gal">Gallon</option>
                                    <option value="oz">Ounce</option>
                                    <option value="floz">Fluid ounce</option>
                                    <option value="lb">Pound</option>
                                </select><br>
                            </label><br>
                        </div>
                    </div>
                </div> 
                <div class="row">
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="expiryDate">Expiry Date:
                                <input type="date" name="expiryDate" id="expiryDate"  placeholder="MM/DD/YYYY">
                            </label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="costPerItem">CostPerItem:
                                <input type="number" step="0.01" name="costPerItem" id="costPerItem" placeholder="Eg:20" >
                            </label><br>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="totalCost">Total Cost:
                                <input type="number" step="0.01" name="totalCost" id="totalCost" placeholder="Eg:200" >
                            </label><br>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="brand">Brand:
                                <input type="text" name="brand" id="brand" placeholder="Eg:Costco" >
                            </label><br>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="category">Category:
                                <input type="text" name="category" id="category" placeholder="Eg:Dairy" >
                            </label><br>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="status">status:
                                <select name="status" id="status">
                                    <option value="">Select...</option>
                                    <option value="Fresh">Fresh</option>
                                    <option value="Early Decline">Early Decline</option>
                                </select>
                            </label><br>
                        </div>
                    </div>
                </div>
                <button id="formAddButton" class="btn btn-primary" type="submit">Add</button>
                <button type="reset" class="btn btn-secondary" id="clearBtn">Clear</button>

                </form>
                {{#if hasErrors}}
                    <ul class="error-list">
                        {{#each error}}
                        <li>
                        {{this}}
                        </li>
                        {{/each}}
                    </ul>
                {{/if}}
                </div>
                </div>

            </div>
            <div id="inventoryList" class="container">

                {{#if foodList.length}}
                    {{#each foodList}}
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title"><a href="/food/view/{{_id}}">{{itemName}}</a> </h5>
                                <p class="card-text">Expiration date: {{expiryDate}}</p>
                                <img src="{{imageUrl}}" alt="Food Image" class="food-image w-25"><br>
                                {{!-- <br><button type="button" class = "btn btn-success" id="shareBtn" >Share</button> --}}
                            </div>
                        </div>
                    {{/each}}
                {{else}}
                    <!-- Message card when foodList is empty -->
                    <div class="card text-center bg-light">
                        <div class="card-body">
                            <p class="card-text">No food items, yet. Add some to get started!</p>
                        </div>
                    </div>
                {{/if}}

            </div><br>
        </main>
    </div>

<script>
 
  const ws = new WebSocket("ws://localhost:8080/");

  document.addEventListener("DOMContentLoaded", function () {
       toastr.options = {
    closeButton: true,
    progressBar: true,
    positionClass: 'toast-top-right',
     timeOut: 10000,  
  };

    // Check if we get expirationNotifications
    let expirationNotifications = {{{json expirationNotifications}}};

    // Parse the string as a JSON array
    expirationNotifications = JSON.parse(expirationNotifications);

 function displayNotificationWithDelay(notification, delay) {
      setTimeout(function () {
        // Display the notification using toastr
        toastr.warning(notification, 'Food Expiration Alert');

        // Check if browser supports the Notification API
        if ('Notification' in window && Notification.permission === 'granted') {
          const notificationObject = new Notification('Food Expiration Alert', {
            body: notification,
            icon: '../../public/assets/notification.png', // Replace with the path to your notification icon
          });

          notificationObject.onclick = function () {
            console.log('Notification clicked.');
          };
        }
      }, delay);
    }

    expirationNotifications.forEach(function (notification, index) {
      console.log("client received notification: ", notification);

      // Display the notification using toastr
       const delay = index * 3000; // 3000 milliseconds = 3 seconds
      displayNotificationWithDelay(notification, delay);

      // Check if browser supports the Notification API
      if ('Notification' in window && Notification.permission === 'granted') {
        const notificationObject = new Notification('Food Expiration Alert', {
          body: notification,
          icon: '../../public/assets/notification.png', // Replace with the path to your notification icon
        });

        notificationObject.onclick = function () {
          console.log('Notification clicked.');
        };
      }
    });

    if ('Notification' in window) {
      Notification.requestPermission().then(permission => {
        if (permission === 'granted') {
          console.log('Notification permission granted.');
        }
      });
    }
  });


</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="/public/js/inventory.js"></script>
</body>

</html>
